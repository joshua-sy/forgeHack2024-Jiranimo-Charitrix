"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));
var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));
var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));
var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));
var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));
var _react = require("react");
var _react2 = require("@emotion/react");
var _constants = require("./constants");
var _constants2 = require("./internal/constants");
var _link = _interopRequireDefault(require("./internal/link"));
var _stage = _interopRequireDefault(require("./internal/stage"));
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2.default)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }
function _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); } /* eslint-disable @atlaskit/design-system/no-nested-styles */ /**
 * @jsxRuntime classic
 */ /** @jsx jsx */ // eslint-disable-next-line @atlaskit/ui-styling-standard/use-compiled -- Ignored via go/DSP-18766
var containerStyles = (0, _react2.css)({
  display: 'grid',
  width: '100%',
  // eslint-disable-next-line @atlaskit/design-system/ensure-design-token-usage
  margin: '0 auto',
  padding: "var(--ds-space-0, 0px)",
  // eslint-disable-next-line @atlaskit/design-system/ensure-design-token-usage, @atlaskit/ui-styling-standard/no-imported-style-values, @atlaskit/ui-styling-standard/no-unsafe-values -- Ignored via go/DSP-18766
  gap: "var(".concat(_constants2.varSpacing, ")"),
  listStyleType: 'none',
  // eslint-disable-next-line @atlaskit/ui-styling-standard/no-nested-selectors, @atlaskit/ui-styling-standard/no-unsafe-selectors -- Ignored via go/DSP-18766
  '&&': {
    marginBlockStart: "var(--ds-space-500, 40px)"
  }
});
var ProgressTracker = exports.default = /*#__PURE__*/function (_PureComponent) {
  (0, _inherits2.default)(ProgressTracker, _PureComponent);
  var _super = _createSuper(ProgressTracker);
  function ProgressTracker() {
    var _this;
    (0, _classCallCheck2.default)(this, ProgressTracker);
    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }
    _this = _super.call.apply(_super, [this].concat(args));
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "state", {
      prevStages: _this.props.items.map(function (stage) {
        return _objectSpread(_objectSpread({}, stage), {}, {
          percentageComplete: 0
        });
      })
    });
    return _this;
  }
  (0, _createClass2.default)(ProgressTracker, [{
    key: "UNSAFE_componentWillReceiveProps",
    value: function UNSAFE_componentWillReceiveProps(nextProps) {
      var _this2 = this;
      var prevStages = nextProps.items.map(function (stage) {
        var oldStage = _this2.props.items.find(function (st) {
          return st.id === stage.id;
        });
        return oldStage !== undefined ? oldStage : stage;
      });
      this.setState({
        prevStages: prevStages
      });
    }
  }, {
    key: "render",
    value: function render() {
      var _this3 = this,
        _listInlineStyles;
      var _this$props = this.props,
        testId = _this$props.testId,
        label = _this$props.label;
      var progressChanges = this.props.items.filter(function (stage, index) {
        return stage.percentageComplete !== _this3.state.prevStages[index].percentageComplete;
      }).length;
      var totalStepsForward = this.props.items.filter(function (stage, index) {
        return stage.percentageComplete > _this3.state.prevStages[index].percentageComplete;
      }).length;
      var totalStepsBack = this.props.items.filter(function (stage, index) {
        return stage.percentageComplete < _this3.state.prevStages[index].percentageComplete;
      }).length;
      var stepsForward = totalStepsForward;
      var stepsBack = totalStepsBack;
      var items = this.props.items.map(function (stage, index) {
        var transitionSpeed = 0;
        var transitionDelay = 0;
        var transitionEasing = progressChanges > 1 ? 'linear' : _constants2.ANIMATION_EASE_OUT;
        if (_this3.props.animated) {
          transitionSpeed = progressChanges > 1 ? _constants2.LINEAR_TRANSITION_SPEED : _constants2.TRANSITION_SPEED;
          if (stage.percentageComplete < _this3.state.prevStages[index].percentageComplete) {
            /**
             * Load each transition sequentially in reverse.
             */
            transitionDelay = (stepsBack - 1) * transitionSpeed;
            stepsBack -= 1;
          } else if (stage.percentageComplete > _this3.state.prevStages[index].percentageComplete) {
            /**
             * Load each transition sequentially.
             */
            transitionDelay = (totalStepsForward - stepsForward) * transitionSpeed;
            stepsForward -= 1;
          }
        }
        return (0, _react2.jsx)(_stage.default, {
          transitionSpeed: transitionSpeed,
          transitionDelay: transitionDelay,
          transitionEasing: transitionEasing,
          key: stage.id,
          item: stage,
          render: _this3.props.render
        });
      });
      var listInlineStyles = (_listInlineStyles = {
        gridTemplateColumns: "repeat(".concat(items.length, ", 1fr)")
      }, (0, _defineProperty2.default)(_listInlineStyles, _constants2.varSpacing, _constants.spacing[this.props.spacing]), (0, _defineProperty2.default)(_listInlineStyles, "maxWidth", 8 * 10 * items.length * 2), _listInlineStyles);
      return (0, _react2.jsx)("ul", {
        "data-testid": testId
        // eslint-disable-next-line @atlaskit/ui-styling-standard/enforce-style-prop -- Ignored via go/DSP-18766
        ,
        style: listInlineStyles,
        css: containerStyles,
        "aria-label": label
      }, items);
    }
  }]);
  return ProgressTracker;
}(_react.PureComponent);
(0, _defineProperty2.default)(ProgressTracker, "defaultProps", {
  items: [],
  spacing: 'cosy',
  render: {
    // Anchor content is coming from another location
    // eslint-disable-next-line jsx-a11y/anchor-has-content
    link: function link(_ref) {
      var item = _ref.item;
      return (0, _react2.jsx)(_link.default, item);
    }
  },
  animated: true,
  label: 'Progress'
});