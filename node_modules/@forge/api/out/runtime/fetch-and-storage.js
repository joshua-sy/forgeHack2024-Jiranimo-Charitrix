"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.__requestAtlassianAsUser = exports.__requestAtlassianAsApp = exports.getRequestStargate = exports.getFetchAPI = exports.getContextAri = void 0;
const fetch_1 = require("../api/fetch");
const runtime_1 = require("../api/runtime");
function getContextAri() {
    return global.api?.__getAppAri?.() ?? (0, runtime_1.__getRuntime)().contextAri;
}
exports.getContextAri = getContextAri;
function getFetchAPI() {
    const { api: sandboxAPI } = global;
    if (sandboxAPI && Object.keys(sandboxAPI).length) {
        return (0, fetch_1.getSandboxRuntimeAPI)(sandboxAPI);
    }
    else {
        return (0, fetch_1.getNodeRuntimeAPI)();
    }
}
exports.getFetchAPI = getFetchAPI;
function getRequestStargate(provider) {
    const sandboxApi = global.api;
    if (sandboxApi) {
        switch (provider) {
            case 'none':
                return sandboxApi.__requestAtlassian;
            case 'app':
                return sandboxApi.asApp().__requestAtlassian;
            case 'user':
                return sandboxApi.asUser().__requestAtlassian;
            default:
                throw new Error(`Unknown provider: ${provider}`);
        }
    }
    return (0, fetch_1.fetchProduct)({ provider, remote: 'stargate' });
}
exports.getRequestStargate = getRequestStargate;
exports.__requestAtlassianAsApp = getRequestStargate('app');
exports.__requestAtlassianAsUser = getRequestStargate('user');
